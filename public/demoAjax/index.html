<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>[TDW] ACiencia - Anales de la Ciencia </title>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <!--<script defer type="text/javascript" src="./inicio.js"></script> -->
    <link rel="stylesheet" type="text/css" href="./styles.css"/>
    <!-- Bootstrap CSS & JS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>
<body>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <h1 class="textFromNavbar text-center">Anales de la ciencia 🔬</h1>
        </div>
        <form id="form-login" method="post">
            <label class="user" for="username">👤Usuario: </label>
            <input  type="text" id="username" name="username" placeholder="Usuario" autofocus/>
            <label class="password" for="password">🔑Contraseña: </label>
            <input type="password" id="password" name="password" placeholder="Contraseña"/>
            <button class="btn btn-success" type="button" id="btn-login" value="Login">Log-in </button>
            <button id="btn-sign-up" type="button" class="btn btn-primary">Registrarse 📝</button>
        </form>
    </div>
</nav>
<!-- Modal Registro -->
<div  id="sign-up-modal" class="modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" >Regístrate 📝</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
            </div>
            <div class="modal-body">
                <form id="form-create-user" method="post">
                    <div class="mb-3">
                        <label for="username-sign-up" class="col-form-label">Usuario:</label>
                        <input id="username-sign-up" type="text" class="form-control"  placeholder="Nombre de usuario" required>
                    </div>
                    <div class="mb-3">
                        <label for="password-sign-up" class="col-form-label">Contraseña:</label>
                        <input id="password-sign-up" type="password" class="form-control"  placeholder="Contraseña" required>
                    </div>
                    <div class="mb-3">
                        <label for="email-sign-up" class="col-form-label">Email:</label>
                        <input id="email-sign-up" type="email" class="form-control"  placeholder="Correo electrónico" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" id="btn-save-user">Guardar</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal Mi Perfil -->
<div id="modalMyProfile"></div>
<!-- Modal Editar Perfil -->
<div id="modalEditProfile"></div>

    <div class="container mx-auto text-center">
    <hr/>
        <code><span id="mytoken"><h3>Bienvenido a Anales de la Ciencia</h3></span></code>
        <code><span id="historial"></span></code>
    <hr/>
    <code><span id="users"></span></code>
    <hr/>
    <code><span id="products">Products: (null)</span></code>
    <hr/>
    <code><span id="persons">Persons: (null)</span></code>
    <hr/>
    <code><span id="entities">Entities: (null)</span></code>
    </div>

<script type="text/javascript">
    let authHeader = null;
    $("#btn-login").click(function(){
        $.post(
            "/access_token",
            $("#form-login").serialize(),
            null
            ).success(function (data, textStatus, request) {
                // => show scopes, users, products, ...
                authHeader = request.getResponseHeader('Authorization');
                //obtenemos el token para ver si es reader o writer
                let token = authHeader.split(' ')[1];   // Elimina 'Bearer '
                let myData = JSON.parse(atob(token.split('.')[1]));
                let userType = myData.scopes;
                if(userType.length === 1) { // ¿writer or reader?
                    if (userType[0] === 'reader')
                        //log reader
                        showDataReader(authHeader,'reader');
                    else
                        //log writer
                        showDataWriter(authHeader,'writer');
                }
                else // reader + writer
                    showDataWriter(authHeader,'writer');
            }).fail(function (xhr) {
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    message = xhr.responseJSON.message;
                }
                alert("Incorrecto :( \n" + message)
            });
    });

    <!-- Mostrar Modal Registro -->
    $("#btn-sign-up").on('click',function (){
        $("#sign-up-modal").modal('show');
    });

    //comprobamos si el usuario
    $("#btn-save-user").click(function (){
        $.ajax({
            type: 'GET',
            url: '/api/v1/users/username/' + $('#username-sign-up').val(),
            success: function (data,textStatus,response){
                alert("El usuario que se desea crear ya existe");
                window.location.href = '/demoAjax/index.html';
                console.log(" Status: " + response.status + " , message: " + response.statusText) ;
            },
            error: function (){
                //guardamos el nuevo usuario
                $.ajax({
                    type: 'POST',
                    url: '/api/v1/users',
                    dataType: 'json',
                    data: {
                        username: $("#username-sign-up").val(),
                        email: $("#email-sign-up").val(),
                        password: $("#password-sign-up").val(),
                    },
                    success:function (){
                       alert("Usuario '" + $("#username-sign-up").val() + "' creado correctamente." +
                           "\nBienvenido!!!! Ahora ya puedes 'Iniciar sesión' con tus credenciales. ");
                        document.location.href = '/demoAjax/index.html';
                    }
                })
            }
        })
    })

    function showDataReader(authHeader) {
        changeCurrentViewToLogged();
        let currentUserName = showToken(authHeader);
        showUsers(authHeader,'reader',currentUserName);
        showProducts(authHeader,'reader');
        showPersons(authHeader,'reader');
        showEntities(authHeader,'reader');
    }

    function showDataWriter(authHeader) {
        changeCurrentViewToLogged();
        let currentUserName = showToken(authHeader);
        showHistorial();
        showUsers(authHeader,'writer',currentUserName);
        showProducts(authHeader,'writer');
        showPersons(authHeader,'writer');
        showEntities(authHeader,'writer');
    }

    function changeCurrentViewToLogged(){
        let login = document.getElementById("form-login");
        let divButtons = document.createElement("div");
        divButtons.className = "btn-group";

        creatingLogoutButton(divButtons);
        creatingMyProfileButton(divButtons);

        login.parentNode.replaceChild(divButtons,login);
    }

    function creatingLogoutButton(divButtons){
        let logout = document.createElement("a");
        logout.className = "btn btn-danger";
        logout.setAttribute("type","button");
        logout.setAttribute("href","/demoAjax/index.html");
        logout.innerHTML = "Logout";

        divButtons.appendChild(logout);
    }

    function creatingMyProfileButton(divButtons){
        let myProfile = document.createElement("button");
        myProfile.className = "btn btn-warning";
        myProfile.setAttribute("id","btn-profile");
        myProfile.setAttribute("type","button");
        myProfile.innerHTML = "Mi perfil 👤";

        divButtons.appendChild(myProfile);
    }

    function showHistorial(){
        let sectionHistory = [];
        sectionHistory.push("<div class='container'>");
        sectionHistory.push("<button id='btn-historial-table' type='button' data-toggle='collapse' data-target='#historial-content' class='btn btn-info' aria-controls='historial-content'>Historial de modificaciones 📋</button>");
        sectionHistory.push("</div>");
        sectionHistory.push("<div class='container'>");
        sectionHistory.push("<div class='container mx-auto text-center'>");
        sectionHistory.push("<div id='historial-content' class='collapse'>");
        sectionHistory.push("<table class='table'>");
        sectionHistory.push("<thead>");
        sectionHistory.push("<tr>");
        sectionHistory.push("<th scope='col' class='text-center'>Hora</th>");
        sectionHistory.push("<th scope='col' class='text-center'>Acción</th>");
        sectionHistory.push("<th scope='col' class='text-center'>Tipo de elemento</th>");
        sectionHistory.push("<th scope='col' class='text-center'>Elemento</th>");
        sectionHistory.push("</tr>");
        sectionHistory.push("</thead>");
        sectionHistory.push("<tbody id='historial-body-table'></tbody>");
        sectionHistory.push("</table>");
        sectionHistory.push("</div>");
        sectionHistory.push("</div>");
        sectionHistory.push("</div>");

        document.getElementById("historial").innerHTML = sectionHistory.join(" ");
    }

    function showToken(authHeader) {
        let token = authHeader.split(' ')[1];   // Elimina 'Bearer '
        let myData = JSON.parse(atob(token.split('.')[1]));
        $('#mytoken').html("<h3> Bienvenido de nuevo <em>'" + myData.sub + "'</em></h3>" +
            "<h5>Permisos de: <em>" + myData.scopes + "</em></h5>"
        );
        return myData.sub;
    }

    function showUsers(authHeader,type,currentUserName) {
        localStorage.setItem("authHeader",authHeader);
        let getUsers = [];
        $.ajax({
            type: "GET",
            url: '/api/v1/users',
            headers: {"Authorization": authHeader},
            // dataType: 'json',
            success: function (data) {
                let x = JSON.stringify(data);
                x = JSON.parse(x);
                for(let i=0;i<x.users.length;i++)
                    getUsers.push(x.users[i]);
                if(type === 'writer') //si writer
                    showContentProfileManagement(getUsers,currentUserName,authHeader);
                else{
                    let sectionUsers = [];
                    sectionUsers.push("<h3>Aún no posees permisos para gestionar usuarios</h3>");
                    sectionUsers.push("<h5>Si quieres obtener permisos envíanos un correo a uno de los siguientes, valoraremos tu petición: </h5><br/>")
                    for(let i=0;i<getUsers.length;i++) {
                        if (getUsers[i].user.role === 'writer')
                            sectionUsers.push("<p>📧  " + getUsers[i].user.email + "</p>");
                    }
                    document.getElementById("users").innerHTML = sectionUsers.join(" ");
                }
                createMyProfileModal(currentUserName,getUsers,authHeader);
            }
        })
    }

    function showContentProfileManagement(users,currentUserName){
        let sectionUsers = [];

        sectionUsers.push("<div class='container'>");
        sectionUsers.push("<button id='btn-profile-management' type='button' data-toggle='collapse' data-target='#profile-management' class='btn btn-success' aria-controls='profile-management'>Gestión de usuarios 👥</button>");
        sectionUsers.push("</div>");
        sectionUsers.push("<div class='container'>");
        sectionUsers.push("<div class='container mx-auto text-center'>");
        sectionUsers.push("<div id='profile-management' class='collapse'>");
        sectionUsers.push("<table class='table'>");
        createTableHead(sectionUsers);
        sectionUsers.push("<tbody>");
        for(let i=0;i<users.length;i++){
            if(users[i].user.username !== currentUserName){
                sectionUsers.push("<tr>");
                sectionUsers.push("<td class='text-center'>" + users[i].user.username + "</td>");
                sectionUsers.push("<td class='text-center'>" + users[i].user.email + "</td>");
                sectionUsers.push("<td class='text-center'>" + users[i].user.role + "</td>");
                if(!users[i].user.inactivo)
                    sectionUsers.push("<td><button id='disable-user' type='button' class='btn btn-danger' onclick='changeUserState("+ users[i].user.id +")'>Inhabilitar usuario</button></td>");//poner inactivo a true
                else
                    sectionUsers.push("<td><button id='enable-user' type='button' class='btn btn-success' onclick='changeUserState("+ users[i].user.id +")'>Habilitar usuario</button></td>");//poner inactivo a false
                sectionUsers.push("<td><button id='change-permissions' type='button' class='btn btn-warning' onclick='changeUserPermissions("+ users[i].user.id +")'>Cambiar permisos</button></td>"); // mostrar modal
                sectionUsers.push("</tr>");
            }
        }
        sectionUsers.push("</tbody>");
        sectionUsers.push("</table>");
        sectionUsers.push("</div>");
        sectionUsers.push("</div>");
        sectionUsers.push("</div>");

        document.getElementById("users").innerHTML = sectionUsers.join("");
    }

    function changeUserState(id){
        $.ajax({
            type: 'GET',
            url: '/api/v1/users/' + id,
            headers: {"Authorization" : localStorage.getItem("authHeader")},
            success: function (data,textStatus,response){
                console.log(data.user.inactivo);
                console.log(response);
                let changeUserEtag = response.getResponseHeader('Etag');
                let stateValue;
                stateValue = data.user.inactivo === false;
                console.log(stateValue);
                $.ajax({
                    type: 'PUT',
                    url: '/api/v1/users/' + id,
                    headers:{"Authorization" : localStorage.getItem("authHeader"), "If-Match": changeUserEtag},
                    dataType: 'json',
                    data: {
                        inactivo: stateValue
                    },
                    success:function (data){
                        console.log(data.user);
                        if(data.user.inactivo === true)
                            alert("Se ha inhabilitado el acceso al usuario: '" + data.user.username + "'");
                        else
                            alert("Se ha habilitado el acceso al usuario: '" + data.user.username + "'");
                    }
                })
            }
        })
    }

    function changeUserPermissions(id){
            $.ajax({
                type: 'GET',
                url: '/api/v1/users/' + id,
                headers: {"Authorization" : localStorage.getItem("authHeader")},
                success: function (data,textStatus,response){
                    console.log(data.user.inactivo);
                    console.log(response);
                    let disableUserEtag = response.getResponseHeader('Etag');
                    let roleValue;
                    if(data.user.role === 'writer')
                        roleValue = 'reader';
                    else roleValue = 'writer';
                    $.ajax({
                        type: 'PUT',
                        url: '/api/v1/users/' + id,
                        headers:{"Authorization" : localStorage.getItem("authHeader"), "If-Match": disableUserEtag},
                        dataType: 'json',
                        data: {
                            role: roleValue
                        },
                        success:function (data){
                            console.log(data.user);
                            alert("Los permisos del usuario: '" + data.user.username + "' han cambiado a "+ value);
                        }
                    })
                }
            })
    }

    function createTableHead(sectionUsers){
        sectionUsers.push("<thead>");
        sectionUsers.push("<tr>");
        sectionUsers.push("<th scope='col' class='text-center'>Usuario</th>");
        sectionUsers.push("<th scope='col' class='text-center'>Email</th>");
        sectionUsers.push("<th scope='col' class='text-center'>Rol</th>");
        sectionUsers.push("</tr>");
        sectionUsers.push("</thead>");
    }

    function showProducts(authHeader,type) {
        let getProducts = [];
        $.ajax({
            type: "GET",
            url: '/api/v1/products',
            headers: {"Authorization": authHeader},
            // dataType: 'json',
            success: function (data) {
                let x = JSON.stringify(data);
                x = JSON.parse(x);
                for(let i=0;i<x.products.length;i++)
                    getProducts.push(x.products[i]);
                if(type === 'reader') //si reader
                    showContentReaderProducts(getProducts,authHeader);
                else //si writer
                    showContentWriterProducts(getProducts,authHeader);
            }
        })
    }

    function showContentReaderProducts(products){
        let sectionProducts = [];

        sectionProducts.push("<div class='container'>");
        sectionProducts.push("<div class='container mx-auto text-center'>");
        sectionProducts.push("<h1>Productos 💡</h1>");
        sectionProducts.push("</div>");
        for(let i=0;i<products.length;i++){
            sectionProducts.push("<div class='container'>");
            sectionProducts.push("<img class='img-fluid' src='"+ products[i].product.imageUrl +"' alt='Product image'>");
            sectionProducts.push("<button id='details' data-toggle='collapse' data-target='#info-product"+i+"' class='btn btn-info'>" + products[i].product.name + " 🔍</button>");
            sectionProducts.push("</div>");
            sectionProducts.push("<div id='info-product"+i+"' class='collapse'>");
            sectionProducts.push("<p>Nombre:  "+ products[i].product.name +"</p>");
            sectionProducts.push("<p>Fecha de nacimiento:  "+ products[i].product.birthDate +"</p>");
            if(products[i].product.deathDate == null)
                sectionProducts.push("<p>Fecha de fallecimiento:   </p>");
            else
                sectionProducts.push("<p>Fecha de fallecimiento:  "+ products[i].product.deathDate +"</p>");
            sectionProducts.push("<p>Wiki: </p><a  class ='linkWiki' href='"+  products[i].product.wikiUrl + "'>"+  products[i].product.wikiUrl +"</a>");
            if(products[i].product.entities != null) {
                let cont = products[i].product.entities.length -1;
                sectionProducts.push("<h4>Relaciones con Entidades:</h4>");
                sectionProducts.push("<p id='entity-product-related"+ i +"'></p>");
                showEntitiesRelatedWithProduct(products[i].product.entities[cont], authHeader,i);
            }
            if(products[i].product.persons != null) {
                let cont = products[i].product.persons.length-1;
                sectionProducts.push("<h4>Relaciones con Personas:</h4>");
                sectionProducts.push("<p id='person-product-related"+ i + "'></p>");
                showPersonsRelatedWithProduct(products[i].product.persons[cont], authHeader,i);
            }
            sectionProducts.push("</div>");
        }
        sectionProducts.push("</div>");
        document.getElementById("products").innerHTML = sectionProducts.join("");
    }

    function showEntitiesRelatedWithProduct(entity,authHeader,pos){
            $.ajax({
                type: "GET",
                url: '/api/v1/entities/' + entity,
                headers: {"Authorization": authHeader},
                success: function (data) {
                    let html = [];
                    html.push("<p><b>Entidad no. "+ data.entity.id + " : </b> "+ data.entity.name +"</p>");
                    document.getElementById("entity-product-related"+ pos).innerHTML = html.join("");
                }
            })
    }

    function showPersonsRelatedWithProduct(person,authHeader,pos){
            $.ajax({
                type: "GET",
                url: '/api/v1/persons/' + person,
                headers: {"Authorization": authHeader},
                success: function (data) {
                    let html = [];
                    html.push("<p><b>Persona no. " +  data.person.id + " : </b> "+ data.person.name +"</p>");
                    document.getElementById("person-product-related"+ pos).innerHTML = html.join("");
                }
            })
    }

    function showContentWriterProducts(products,authHeader){
        let sectionProducts = [];

        sectionProducts.push("<div class='container'>");
        sectionProducts.push("<div class='container mx-auto text-center'>");
        sectionProducts.push("<h1>Productos 💡</h1>");
        sectionProducts.push("</div>");
        for(let i=0;i<products.length;i++){
            sectionProducts.push("<div class='container'>");
            sectionProducts.push("<img class='img-fluid' src='"+ products[i].product.imageUrl + "' alt='Product image'>");
            sectionProducts.push("<h4>" + products[i].product.name + "</h4>");
            sectionProducts.push("<div class='btn-group'>")
            sectionProducts.push("<a id='editable-product' type='button' class='btn btn-warning' target='popup' href='/demoAjax/edit.html?id=" + products[i].product.id + "&type=products" + "&key=" + authHeader + "' " +
                "onclick='window.open(this.href,this.target,\" toolbar=0 , location=1 , status=0 , menubar=1 , scrollbars=0 , resizable=1 ,left=100pt,top=150pt,width=450px,height=510px\"); return false; '>Editar ✏️</a>");
            sectionProducts.push("<button id='delete-product"+i+"' class='btn btn-danger' type='button' onclick='deleteProduct(" + products[i].product.id + ")'>Borrar 🗑️</button>");
            sectionProducts.push("</div>");
            sectionProducts.push("</div>");
        }
        sectionProducts.push("<div class='container mx-auto text-center'>");
        sectionProducts.push("<button id='btn-add-product' type='button' class='btn btn-success'>+ Añadir Producto</button>");
        sectionProducts.push("</div>");
        sectionProducts.push("</div>");

        createAddProductModal(sectionProducts);
        document.getElementById("products").innerHTML = sectionProducts.join("");
        <!-- Mostrar Modal Añadir Producto -->
        $("#btn-add-product").on('click',function (){
            $("#add-product-modal").modal('show');
        });

        //añadir nuevo producto
        $("#btn-save-add-product").click(function (){
            $.ajax({
                type: "POST",
                url: "/api/v1/products",
                headers: {"Authorization": authHeader},
                dataType: 'json',
                data: {
                    name: $("#create-product-name").val(),
                    birthDate: $("#create-product-birthDate").val(),
                    deathDate: $("#create-product-deathDate").val(),
                    imageUrl: $("#create-product-imageUrl").val(),
                    wikiUrl: $("#create-product-wikiUrl").val(),
                },
                success: function (){
                    alert("Producto creado correctamente");
                    $("#add-product-modal").modal('hide');
                    addRowToHistorial('Producto 💡',$("#create-product-name").val(),'creado');
                },
                error: function (error){
                    console.log(error);
                    alert("El producto que se desea crear ya existe");
                }
            })
        })
    }

    function deleteProduct(id){
        $.ajax({
            type: 'GET',
            url: '/api/v1/products/' + id,
            headers: {"Authorization": authHeader},
            success: function (data) {
                addRowToHistorial('Producto 💡',data.product.name,'eliminado');
            }
        })

        $.ajax({
            type: "DELETE",
            url: "/api/v1/products/" + id,
            headers: {"Authorization": authHeader},
            success: function (){
                alert("Producto eliminado correctamente.");
            }
        })
    }

    function addRowToHistorial(elementType,elementName,action){
        let padre = document.getElementById("historial-body-table");
        let newRow = document.createElement("tr");

        createColDateAndTime(newRow);
        createColAction(newRow,action);
        createColTypeElement(newRow,elementType);
        createColElement(newRow, elementName);

        padre.appendChild(newRow);
    }

    function createColDateAndTime(newRow){
        let hoy = new Date();
        let fecha = hoy.getFullYear()+ '-' + (hoy.getMonth() +1) + '-' + hoy.getDate() ;
        let hora = hoy.getHours() + ':' + hoy.getMinutes() + ':' + hoy.getSeconds();
        let newColDateModified = document.createElement("td");
        newColDateModified .className = "text-center";
        newColDateModified .innerHTML = ""+ fecha + ' ' + hora;

        newRow.appendChild(newColDateModified);
    }

    function createColAction(newRow,action){
        let newColAction = document.createElement("td");
        newColAction.className = "text-center";
        newColAction.innerHTML= action;

        newRow.appendChild(newColAction);
    }

    function createColTypeElement(newRow,elementType){
        let newColTypeElement = document.createElement("td");
        newColTypeElement.className = "text-center";
        newColTypeElement.innerHTML= "" + elementType;

        newRow.appendChild(newColTypeElement);
    }

    function createColElement(newRow,element){
        let newColElement = document.createElement("td");
        newColElement.className = "text-center";
        newColElement.innerHTML= "" + element;

        newRow.appendChild(newColElement);
    }

    function createAddProductModal(sectionProducts){
        sectionProducts.push("<div id='add-product-modal' class='modal' tabIndex='-1' aria-labelledby='add-productModalLabel' aria-hidden='true'>");
        sectionProducts.push("<div class='modal-dialog'>");
        sectionProducts.push("<div class='modal-content'>");
        sectionProducts.push("<div class='modal-header'>");
        sectionProducts.push("<h2 class='modal-title'>Añadiendo Producto 💡</h2>");
        sectionProducts.push("<button type='button' class='close' data-dismiss='modal' aria-label='Close'>");
        sectionProducts.push("<span aria-hidden='true'>&times;</span>");
        sectionProducts.push("</button>");
        sectionProducts.push("</div>");
        sectionProducts.push("<div class='modal-body'>");
        sectionProducts.push("<form id='form-create-product' method='post'>");
        sectionProducts.push("<div class='mb-3'>");
        sectionProducts.push("<label for='create-product-name' class='col-form-label'>Nombre producto:</label>");
        sectionProducts.push("<input id='create-product-name' type='text' class='form-control' placeholder='Nombre del producto' required>");
        sectionProducts.push("</div>");
        sectionProducts.push("<div class='mb-3'>");
        sectionProducts.push("<label for='create-product-birthDate' class='col-form-label'>Fecha de nacimiento:</label>");
        sectionProducts.push("<input id='create-product-birthDate' type='text' class='form-control' placeholder='1937-10-10 (formato)'>");
        sectionProducts.push("</div>");
        sectionProducts.push("<div class='mb-3'>");
        sectionProducts.push("<label for='create-product-deathDate' class='col-form-label'>Fecha de fallecimiento:</label>");
        sectionProducts.push("<input id='create-product-deathDate' type='text' class='form-control' placeholder='1937-10-10 (formato)'>");
        sectionProducts.push("</div>");
        sectionProducts.push("<div class='mb-3'>");
        sectionProducts.push("<label for='create-product-imageUrl' class='col-form-label'>Imagen:</label>");
        sectionProducts.push("<input id='create-product-imageUrl' type='text' class='form-control' placeholder='Imagen (url)' required>");
        sectionProducts.push("</div>");
        sectionProducts.push("<div class='mb-3'>");
        sectionProducts.push("<label for='create-product-wikiUrl' class='col-form-label'>Wiki:</label>");
        sectionProducts.push("<input id='create-product-wikiUrl' type='text' class='form-control' placeholder='Wiki (url)' required>");
        sectionProducts.push("</div>");
        sectionProducts.push("</form>");
        sectionProducts.push("</div>");
        sectionProducts.push("<div class='modal-footer'>");
        sectionProducts.push("<button type='button' class='btn btn-success' id='btn-save-add-product'>Guardar</button>");
        sectionProducts.push("</div>");
        sectionProducts.push("</div>");
        sectionProducts.push("</div>");
        sectionProducts.push("</div>");
    }

    function showPersons(authHeader,userType) {
        let getPersons = [];
        $.ajax({
            type: "GET",
            url: '/api/v1/persons',
            headers: {"Authorization": authHeader},
            // dataType: 'json',
            success: function (data) {
                let x = JSON.stringify(data);
                x = JSON.parse(x);
                for(let i=0;i<x.persons.length;i++)
                    getPersons.push(x.persons[i]);
                if(userType === 'reader') //si reader
                    showContentReaderPersons(getPersons);
                else //si writer
                    showContentWriterPersons(getPersons,authHeader);
            }
        })
    }

    function showContentReaderPersons(persons){
        let sectionPersons = [];

        sectionPersons.push("<div class='container'>");
        sectionPersons.push("<div class='container mx-auto text-center'>");
        sectionPersons.push("<h1>Personas 🙎‍♂🙎‍♀</h1>");
        sectionPersons.push("</div>");
        for(let i=0;i<persons.length;i++){
            sectionPersons.push("<div class='container'>");
            sectionPersons.push("<img class='img-fluid' src='"+ persons[i].person.imageUrl +"' alt='Person image'>");
            sectionPersons.push("<button id='details' data-toggle='collapse' data-target='#info-person"+i+"' class='btn btn-info'>" + persons[i].person.name + " 🔍</button>");
            sectionPersons.push("</div>");
            sectionPersons.push("<div id='info-person"+i+"' class='collapse'>");
            sectionPersons.push("<p>Nombre:  "+ persons[i].person.name +"</p>");
            sectionPersons.push("<p>Fecha de nacimiento:  "+ persons[i].person.birthDate +"</p>");
            if(persons[i].person.deathDate == null)
                sectionPersons.push("<p>Fecha de fallecimiento:  </p>");
            else
                sectionPersons.push("<p>Fecha de fallecimiento:  "+ persons[i].person.deathDate +"</p>");
            sectionPersons.push("<p>Wiki: </p><a class ='linkWiki' href='"+  persons[i].person.wikiUrl + "'>"+  persons[i].person.wikiUrl +"</a>");
            console.log(persons[i].person)
            if(persons[i].person.entities != null) {
                let cont = persons[i].person.entities.length -1;
                sectionPersons.push("<h4>Relaciones con Entidades:</h4>");
                sectionPersons.push("<p id='entity-person-related"+ i +"'></p>");
                showEntitiesRelatedWithPerson(persons[i].person.entities[cont], authHeader,i);
            }
            if(persons[i].person.products != null) {
                let cont = persons[i].person.products.length-1;
                sectionPersons.push("<h4>Relaciones con Productos:</h4>");
                sectionPersons.push("<p id='product-person-related"+ i + "'></p>");
                showProductsRelatedWithPerson(persons[i].person.products[cont], authHeader,i);
            }
            sectionPersons.push("</div>");
        }
        sectionPersons.push("</div>");
        document.getElementById("persons").innerHTML = sectionPersons.join("");
    }

    function showEntitiesRelatedWithPerson(entity,authHeader,pos){
        $.ajax({
            type: "GET",
            url: '/api/v1/entities/' + entity,
            headers: {"Authorization": authHeader},
            success: function (data) {
                let html = [];
                html.push("<p><b>Entidad no. "+ data.entity.id + " : </b> "+ data.entity.name +"</p>");
                document.getElementById("entity-person-related"+ pos).innerHTML = html.join("");
            }
        })
    }

    function showProductsRelatedWithPerson(product,authHeader,pos){
        $.ajax({
            type: "GET",
            url: '/api/v1/products/' + product,
            headers: {"Authorization": authHeader},
            success: function (data) {
                let html = [];
                html.push("<p><b>Producto no. " +  data.product.id + " : </b> "+ data.product.name +"</p>");
                document.getElementById("product-person-related"+ pos).innerHTML = html.join("");
            }
        })
    }

    function showContentWriterPersons(persons,authHeader){
        let sectionPersons = [];

        sectionPersons.push("<div class='container'>");
        sectionPersons.push("<div class='container mx-auto text-center'>");
        sectionPersons.push("<h1>Personas 🙎‍♂🙎‍♀</h1>");
        sectionPersons.push("</div>");
        for(let i=0;i<persons.length;i++){
            sectionPersons.push("<div class='container'>");
            sectionPersons.push("<img class='img-fluid' src='"+ persons[i].person.imageUrl + "' alt='Person image'>");
            sectionPersons.push("<h4>" + persons[i].person.name + "</h4>");
            sectionPersons.push("<div class='btn-group'>");
            sectionPersons.push("<a id='editable-person' type='button' class='btn btn-warning' target='popup' href='/demoAjax/edit.html?id=" + persons[i].person.id + "&type=persons" + "&key=" + authHeader + "' " +
                "onclick='window.open(this.href,this.target,\" toolbar=0 , location=1 , status=0 , menubar=1 , scrollbars=0 , resizable=1 ,left=100pt,top=150pt,width=450px,height=510px\"); return false; '>Editar ✏️</a>");
            sectionPersons.push("<button class='btn btn-danger' type='button' onclick='deletePerson(" + persons[i].person.id + ")'>Borrar 🗑️</button>");
            sectionPersons.push("</div>");
            sectionPersons.push("</div>");
        }
        sectionPersons.push("<div class='container mx-auto text-center'>");
        sectionPersons.push("<button id='btn-add-person' class='btn btn-success' >+ Añadir Persona</button>");
        sectionPersons.push("</div>");
        sectionPersons.push("</div>");

        createAddPersonModal(sectionPersons);
        document.getElementById("persons").innerHTML = sectionPersons.join("");
        <!-- Mostrar Modal Añadir Persona -->
        $("#btn-add-person").on('click',function (){
            $("#add-person-modal").modal('show');
        });

        //añadir nueva persona
        $("#btn-save-person").click(function (){
            $.ajax({
                type: "POST",
                url: "/api/v1/persons",
                headers: {"Authorization": authHeader},
                dataType: 'json',
                data: {
                    name: $("#create-person-name").val(),
                    birthDate: $("#create-person-birthDate").val(),
                    deathDate: $("#create-person-deathDate").val(),
                    imageUrl: $("#create-person-imageUrl").val(),
                    wikiUrl: $("#create-person-wikiUrl").val(),
                },
                success: function (){
                    alert("Persona creada correctamente");
                    $("#add-person-modal").modal('hide');
                    addRowToHistorial('Persona 🙎‍♂🙎‍♀',$("#create-person-name").val(),'creado');
                },
                error: function (error){
                    console.log(error);
                    alert("La persona que se desea crear ya existe");
                }
            })
        })
    }

    function deletePerson(id){
        $.ajax({
            type: 'GET',
            url: '/api/v1/persons/' + id,
            headers: {"Authorization": authHeader},
            success: function (data) {
                console.log(data);
                console.log(data.name);
                addRowToHistorial('Persona 🙎‍♂🙎‍♀',data.person.name,'eliminado');
            }
        })

        $.ajax({
            type: "DELETE",
            url: "/api/v1/persons/" + id,
            headers: {"Authorization": authHeader},
            success: function (){
                alert("Persona eliminada correctamente.");
            }
        })
    }

    function createAddPersonModal(sectionPersons){
        sectionPersons.push("<div id='add-person-modal' class='modal' tabIndex='-1' aria-labelledby='add-personModalLabel' aria-hidden='true'>");
        sectionPersons.push("<div class='modal-dialog'>");
        sectionPersons.push("<div class='modal-content'>");
        sectionPersons.push("<div class='modal-header'>");
        sectionPersons.push("<h2 class='modal-title'>Añadiendo Persona 🙎‍♂🙎‍♀</h2>");
        sectionPersons.push("<button type='button' class='close' data-dismiss='modal' aria-label='Close'>");
        sectionPersons.push("<span aria-hidden='true'>&times;</span>");
        sectionPersons.push("</button>");
        sectionPersons.push("</div>");
        sectionPersons.push("<div class='modal-body'>");
        sectionPersons.push("<form id='form-create-person' method='post'>");
        sectionPersons.push("<div class='mb-3'>");
        sectionPersons.push("<label for='create-person-name' class='col-form-label'>Nombre persona:</label>");
        sectionPersons.push("<input id='create-person-name' type='text' class='form-control' placeholder='Nombre de la persona' required>");
        sectionPersons.push("</div>");
        sectionPersons.push("<div class='mb-3'>");
        sectionPersons.push("<label for='create-person-birthDate' class='col-form-label'>Fecha de nacimiento:</label>");
        sectionPersons.push("<input id='create-person-birthDate' type='text' class='form-control' placeholder='1937-10-10 (formato)'>");
        sectionPersons.push("</div>");
        sectionPersons.push("<div class='mb-3'>");
        sectionPersons.push("<label for='create-person-deathDate' class='col-form-label'>Fecha de fallecimiento:</label>");
        sectionPersons.push("<input id='create-person-deathDate' type='text' class='form-control' placeholder='1937-10-10 (formato)'>");
        sectionPersons.push("</div>");
        sectionPersons.push("<div class='mb-3'>");
        sectionPersons.push("<label for='create-person-imageUrl' class='col-form-label'>Imagen:</label>");
        sectionPersons.push("<input id='create-person-imageUrl' type='text' class='form-control' placeholder='Imagen (url)' required>");
        sectionPersons.push("</div>");
        sectionPersons.push("<div class='mb-3'>");
        sectionPersons.push("<label for='create-person-wikiUrl' class='col-form-label'>Wiki:</label>");
        sectionPersons.push("<input id='create-person-wikiUrl' type='text' class='form-control' placeholder='Wiki (url)' required>");
        sectionPersons.push("</div>");
        sectionPersons.push("</form>");
        sectionPersons.push("</div>");
        sectionPersons.push("<div class='modal-footer'>");
        sectionPersons.push("<button type='button' class='btn btn-success' id='btn-save-person'>Guardar</button>");
        sectionPersons.push("</div>");
        sectionPersons.push("</div>");
        sectionPersons.push("</div>");
        sectionPersons.push("</div>");
    }

    function showEntities(authHeader,type) {
        let getEntities = [];
        $.ajax({
            type: "GET",
            url: '/api/v1/entities',
            headers: {"Authorization": authHeader},
            // dataType: 'json',
            success: function (data) {
                let x = JSON.stringify(data);
                x = JSON.parse(x);
                for(let i=0;i<x.entities.length;i++)
                    getEntities.push(x.entities[i]);
                if(type === 'reader')//si reader
                    showContentReaderEntities(getEntities);
                else//si writer
                    showContentWriterEntities(getEntities,authHeader);
            }
        })
    }

    function showContentReaderEntities(entities){
        let sectionEntities = [];

        sectionEntities.push("<div class='container'>");
        sectionEntities.push("<div class='container mx-auto text-center'>");
        sectionEntities.push("<h1>Entidades 🏢</h1>");
        sectionEntities.push("</div>");
        for(let i=0;i<entities.length;i++){
            sectionEntities.push("<div class='container'>");
            sectionEntities.push("<img class='img-fluid' src='"+ entities[i].entity.imageUrl +"' alt='Entity image'>");
            sectionEntities.push("<button id='details' data-toggle='collapse' data-target='#info-entity"+i+"' class='btn btn-info'>" + entities[i].entity.name + " 🔍</button>");
            sectionEntities.push("</div>");
            sectionEntities.push("<div id='info-entity"+i+"' class='collapse'>");
            sectionEntities.push("<p>Nombre:  "+ entities[i].entity.name +"</p>");
            sectionEntities.push("<p>Fecha de nacimiento:  "+ entities[i].entity.birthDate +"</p>");
            if(entities[i].entity.deathDate == null)
                sectionEntities.push("<p>Fecha de fallecimiento:  </p>");
            else
                sectionEntities.push("<p>Fecha de fallecimiento:  "+ entities[i].entity.deathDate +"</p>");
            sectionEntities.push("<p>Wiki: </p><a class ='linkWiki' href='"+  entities[i].entity.wikiUrl + "'>"+  entities[i].entity.wikiUrl +"</a>");
            if(entities[i].entity.products != null) {
                let cont = entities[i].entity.products.length -1;
                sectionEntities.push("<h4>Relaciones con Productos:</h4>");
                sectionEntities.push("<p id='product-entity-related"+ i +"'></p>");
                showProductsRelatedWithEntity(entities[i].entity.products[cont], authHeader,i);
            }
            if(entities[i].entity.persons != null) {
                let cont = entities[i].entity.persons.length-1;
                sectionEntities.push("<h4>Relaciones con Personas:</h4>");
                sectionEntities.push("<p id='person-entity-related"+ i + "'></p>");
                showPersonsRelatedWithEntity(entities[i].entity.persons[cont], authHeader,i);
            }
            sectionEntities.push("</div>");
        }
        sectionEntities.push("</div>");
        document.getElementById("entities").innerHTML = sectionEntities.join("");
    }

    function showProductsRelatedWithEntity(product,authHeader,pos){
        $.ajax({
            type: "GET",
            url: '/api/v1/products/' + product,
            headers: {"Authorization": authHeader},
            success: function (data) {
                let html = [];
                html.push("<p><b>Producto no. "+ data.product.id + " : </b> "+ data.product.name +"</p>");
                document.getElementById("product-entity-related"+ pos).innerHTML = html.join("");
            }
        })
    }

    function showPersonsRelatedWithEntity(person,authHeader,pos){
        $.ajax({
            type: "GET",
            url: '/api/v1/persons/' + person,
            headers: {"Authorization": authHeader},
            success: function (data) {
                let html = [];
                html.push("<p><b>Persona no. " +  data.person.id + " : </b> "+ data.person.name +"</p>");
                document.getElementById("person-entity-related"+ pos).innerHTML = html.join("");
            }
        })
    }

    function showContentWriterEntities(entities,authHeader){
        let sectionEntities = [];

        sectionEntities.push("<div class='container'>");
        sectionEntities.push("<div class='container mx-auto text-center'>");
        sectionEntities.push("<h1>Entidades 🏢</h1>");
        sectionEntities.push("</div>");
        for(let i=0;i<entities.length;i++){
            sectionEntities.push("<div class='container'>");
            sectionEntities.push("<img class='img-fluid' src='"+ entities[i].entity.imageUrl + "' alt='Entity image'>");
            sectionEntities.push("<h4>" + entities[i].entity.name + "</h4>");
            sectionEntities.push("<div class='btn-group'>");
            sectionEntities.push("<a id='editable-entity' type='button' class='btn btn-warning' target='popup' href='/demoAjax/edit.html?id=" + entities[i].entity.id + "&type=entities" + "&key=" + authHeader + "' " +
                "onclick='window.open(this.href,this.target,\" toolbar=0 , location=1 , status=0 , menubar=1 , scrollbars=0 , resizable=1 ,left=100pt,top=150pt,width=450px,height=510px\"); return false; '>Editar ✏️</a>");
            sectionEntities.push("<button  class='btn btn-danger' type='button' onclick='deleteEntity(" + entities[i].entity.id + ")'>Borrar 🗑️️</button>");
            sectionEntities.push("</div>");
            sectionEntities.push("</div>");
        }
        sectionEntities.push("<div class='container mx-auto text-center'>");
        sectionEntities.push("<button id='btn-add-entity' class='btn btn-success' >+ Añadir Entidad</button>");
        sectionEntities.push("</div>");
        sectionEntities.push("</div>");

        createAddEntityModal(sectionEntities);
        document.getElementById("entities").innerHTML = sectionEntities.join("");
        <!-- Mostrar Modal Añadir Entidad -->
        $("#btn-add-entity").on('click',function (){
            $("#add-entity-modal").modal('show');
        });

        //añadir nueva entidad
        $("#btn-save-entity").click(function (){
            $.ajax({
                type: "POST",
                url: "/api/v1/entities",
                headers: {"Authorization": authHeader},
                dataType: 'json',
                data: {
                    name: $("#create-entity-name").val(),
                    birthDate: $("#create-entity-birthDate").val(),
                    deathDate: $("#create-entity-deathDate").val(),
                    imageUrl: $("#create-entity-imageUrl").val(),
                    wikiUrl: $("#create-entity-wikiUrl").val(),
                },
                success: function (){
                   alert("Entidad creada correctamente");
                   $("#add-entity-modal").modal('hide');
                   addRowToHistorial('Entidad 🏢',$("#create-entity-name").val(),'creado');
                },
                error: function (error){
                    console.log(error);
                    alert("La entidad que se quiere crear ya existe");
                }
            })
        })
    }

    function deleteEntity(id){
        $.ajax({
            type: 'GET',
            url: '/api/v1/entities/' + id,
            headers: {"Authorization": authHeader},
            success: function (data) {
                addRowToHistorial('Entidad 🏢',data.entity.name,'eliminado');
            }
        })

        $.ajax({
            type: "DELETE",
            url: "/api/v1/entities/" + id,
            headers: {"Authorization": authHeader},
            success: function (){
                alert("Entidad eliminada correctamente.");
            }
        })
    }

    function createAddEntityModal(sectionEntities){
        sectionEntities.push("<div id='add-entity-modal' class='modal' tabIndex='-1' aria-labelledby='add-entityModalLabel' aria-hidden='true'>");
        sectionEntities.push("<div class='modal-dialog'>");
        sectionEntities.push("<div class='modal-content'>");
        sectionEntities.push("<div class='modal-header'>");
        sectionEntities.push("<h2 class='modal-title'>Añadiendo Entidad 🏢</h2>");
        sectionEntities.push("<button type='button' class='close' data-dismiss='modal' aria-label='Close'>");
        sectionEntities.push("<span aria-hidden='true'>&times;</span>");
        sectionEntities.push("</button>");
        sectionEntities.push("</div>");
        sectionEntities.push("<div class='modal-body'>");
        sectionEntities.push("<form id='form-create-entity' method='post'>");
        sectionEntities.push("<div class='mb-3'>");
        sectionEntities.push("<label for='create-entity-name' class='col-form-label'>Nombre entidad:</label>");
        sectionEntities.push("<input id='create-entity-name' type='text' class='form-control' placeholder='Nombre de la entidad' required>");
        sectionEntities.push("</div>");
        sectionEntities.push("<div class='mb-3'>");
        sectionEntities.push("<label for='create-entity-birthDate' class='col-form-label'>Fecha de nacimiento:</label>");
        sectionEntities.push("<input id='create-entity-birthDate' type='text' class='form-control' placeholder='1937-10-10 (formato)' >");
        sectionEntities.push("</div>");
        sectionEntities.push("<div class='mb-3'>");
        sectionEntities.push("<label for='create-entity-deathDate' class='col-form-label'>Fecha de fallecimiento:</label>");
        sectionEntities.push("<input id='create-entity-deathDate' type='text' class='form-control' placeholder='1937-10-10 (formato)'>");
        sectionEntities.push("</div>");
        sectionEntities.push("<div class='mb-3'>");
        sectionEntities.push("<label for='create-entity-imageUrl' class='col-form-label'>Imagen:</label>");
        sectionEntities.push("<input id='create-entity-imageUrl' type='text' class='form-control' placeholder='Imagen (url)' required>");
        sectionEntities.push("</div>");
        sectionEntities.push("<div class='mb-3'>");
        sectionEntities.push("<label for='create-entity-wikiUrl' class='col-form-label'>Wiki:</label>");
        sectionEntities.push("<input id='create-entity-wikiUrl' type='text' class='form-control' placeholder='Wiki (url)' required>");
        sectionEntities.push("</div>");
        sectionEntities.push("</form>");
        sectionEntities.push("</div>");
        sectionEntities.push("<div class='modal-footer'>");
        sectionEntities.push("<button type='button' class='btn btn-success' id='btn-save-entity'>Guardar</button>");
        sectionEntities.push("</div>");
        sectionEntities.push("</div>");
        sectionEntities.push("</div>");
        sectionEntities.push("</div>");
    }

    function createMyProfileModal(currentUserName,users,authHeader){
        let posCurrentUser;
        let sectionMyProfile = [];
        for(let i=0;i<users.length;i++){
            if(users[i].user.username === currentUserName)
                posCurrentUser = i;
        }
        sectionMyProfile.push("<div id='my-profile-modal' class='modal' tabindex='-1' aria-labelledby='myProfileModalLabel' aria-hidden='true'>");
        sectionMyProfile.push("<div class='modal-dialog'>");
        sectionMyProfile.push("<div class='modal-content'>");
        sectionMyProfile.push("<div class='modal-header'>");
        sectionMyProfile.push("<h3 class='modal-title'>Mi perfil 👤</h3>");
        sectionMyProfile.push("<button type='button' class='close' data-dismiss='modal' aria-label='Close'>");
        sectionMyProfile.push("<span aria-hidden='true'>&times;</span>");
        sectionMyProfile.push("</button>");
        sectionMyProfile.push("</div>");
        sectionMyProfile.push("<div class='modal-body'>");
        sectionMyProfile.push("<label for='username-profile' class='col-form-label'>Nombre de usuario:</label>");
        sectionMyProfile.push("<p id='password-profile'>" + users[posCurrentUser].user.username + "</p>");
        sectionMyProfile.push("<label for='name-profile' class='col-form-label'>Nombre:</label>");
        sectionMyProfile.push("<p id='name-profile'>" + users[posCurrentUser].user.name + "</p>");
        sectionMyProfile.push("<label for='birthDate-profile' class='col-form-label'>Fecha de nacimiento:</label>");
        sectionMyProfile.push("<p id='birthDate-profile'>" + users[posCurrentUser].user.birthDate + "</p>");
        sectionMyProfile.push("<label for='email-profile' class='col-form-label'>Email:</label>");
        sectionMyProfile.push("<p id='email-profile'>" + users[posCurrentUser].user.email + "</p>");
        sectionMyProfile.push("<div class='modal-footer'>");
        sectionMyProfile.push("<button type='button' class='btn btn-success' id='btn-edit-user'>Editar mi perfil ✏️</button>");
        sectionMyProfile.push("<button type='button' class='btn btn-danger' id='btn-delete-user'>Darse de baja </button>");
        sectionMyProfile.push("</div>");
        sectionMyProfile.push("</div>");
        sectionMyProfile.push("</div>");
        sectionMyProfile.push("</div>");
        sectionMyProfile.push("</div>");
        sectionMyProfile.push("</div>");

        document.getElementById("modalMyProfile").innerHTML = sectionMyProfile.join("");
        <!-- Mostrar Modal Mi Perfil -->
        $("#btn-profile").on('click',function (){
            $("#my-profile-modal").modal('show');
        });

        $("#btn-delete-user").click(function (){
            $.ajax({
                type: "DELETE",
                url: '/api/v1/users/' + users[posCurrentUser].user.id,
                headers: {"Authorization" : authHeader},
                success: function (){
                    alert("Se ha borrado el usuario '" +  users[posCurrentUser].user.username +
                        "'\nLamentamos tu partida 😔 .\nNo obstante,vuelve siempre que quieras 😊.");
                    document.location.href = '/demoAjax/index.html';
                }
            })
        });
        createMyEditProfileModal(users,posCurrentUser,authHeader);
    }

    function createMyEditProfileModal(users,posCurrentUser,authHeader){
        let sectionEditProfile = [];

        sectionEditProfile.push("<div id='edit-my-profile-modal' class='modal' tabIndex='-1' aria-labelledby='edit-myProfileModalLabel' aria-hidden='true'>");
        sectionEditProfile.push("<div class='modal-dialog'>");
        sectionEditProfile.push("<div class='modal-content'>");
        sectionEditProfile.push("<div class='modal-header'>");
        sectionEditProfile.push("<h2 class='modal-title'>Editando Usuario ✏️👤</h2>");
        sectionEditProfile.push("<button type='button' class='close' data-dismiss='modal' aria-label='Close'>");
        sectionEditProfile.push("<span aria-hidden='true'>&times;</span>");
        sectionEditProfile.push("</button>");
        sectionEditProfile.push("</div>");
        sectionEditProfile.push("<div class='modal-body'>");
        sectionEditProfile.push("<div class='mb-3'>");
        sectionEditProfile.push("<label for='username-edit-profile' class='col-form-label'>Nombre de usuario:</label>");
        sectionEditProfile.push("<p id='username-edit-profile'>" + users[posCurrentUser].user.username + "</p>");
        sectionEditProfile.push("</div>");
        sectionEditProfile.push("<form id='form-create-entity' method='post'>");
        sectionEditProfile.push("<div class='mb-3'>");
        sectionEditProfile.push("<label for='name-edit-profile' class='col-form-label'>Nombre:</label>");
        sectionEditProfile.push("<input id='name-edit-profile' type='text' class='form-control' value='" + users[posCurrentUser].user.name + "'>");
        sectionEditProfile.push("</div>");
        sectionEditProfile.push("<div class='mb-3'>");
        sectionEditProfile.push("<label for='birthDate-edit-profile' class='col-form-label'>Fecha de nacimiento:</label>");
        sectionEditProfile.push("<input id='birthDate-edit-profile' type='text' class='form-control' value='" + users[posCurrentUser].user.birthDate + "'>");
        sectionEditProfile.push("</div>");
        sectionEditProfile.push("<div class='mb-3'>");
        sectionEditProfile.push("<label for='email-edit-profile' class='col-form-label'>Email:</label>");
        sectionEditProfile.push("<input id='email-edit-profile' type='text' class='form-control' value='" + users[posCurrentUser].user.email + "'>");
        sectionEditProfile.push("</div>");
        sectionEditProfile.push("</form>");
        sectionEditProfile.push("</div>");
        sectionEditProfile.push("<div class='modal-footer'>");
        sectionEditProfile.push("<button type='button' class='btn btn-success' id='btn-save-my-profile'>Guardar</button>");
        sectionEditProfile.push("</div>");
        sectionEditProfile.push("</div>");
        sectionEditProfile.push("</div>");
        sectionEditProfile.push("</div>");

        document.getElementById("modalEditProfile").innerHTML = sectionEditProfile.join("");
        <!-- Mostrar Modal Editar Perfil -->
        $("#btn-edit-user").on('click',function (){
            $("#edit-my-profile-modal").modal('show');
        });

        $("#btn-save-my-profile").click(function (){
            $.ajax({
                type: "GET",
                url: "/api/v1/users/" + users[posCurrentUser].user.id,
                headers:{"Authorization" : authHeader},
                success:function (data,textStatus,response){
                    let userEtag = response.getResponseHeader('Etag');
                    $.ajax({
                        type: "PUT",
                        url: "/api/v1/users/" + users[posCurrentUser].user.id ,
                        headers: {"Authorization": authHeader,"If-Match" : userEtag},
                        dataType: 'json',
                        data:{
                            name: $("#name-edit-profile").val(),
                            birthDate: $("#birthDate-edit-profile").val(),
                            email: $("#email-edit-profile").val()
                        },
                        success: function (data){
                            console.log(data);
                            alert("Perfil actualizado correctamente");
                            $("#edit-my-profile-modal").modal('hide');
                            $("#my-profile-modal").modal('hide');
                            if(data.user.role === 'writer')
                                addRowToHistorial('Perfil 👤','','editado');
                        }
                    })
                }
            })
        })
    }

</script>
</body>
</html>